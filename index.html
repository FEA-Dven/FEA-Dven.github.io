<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta property="og:type" content="website">
<meta property="og:title" content="FEA-Dven的技术博客">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="FEA-Dven的技术博客">
<meta property="article:author" content="FEA-Dven">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"always","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title>FEA-Dven的技术博客</title>
  








<meta name="generator" content="Hexo 4.2.1"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">FEA-Dven的技术博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/05/24/ducheng/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="FEA-Dven">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="FEA-Dven的技术博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/05/24/ducheng/" itemprop="url">react+koa2打造都城点餐系统</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-05-24T17:32:40+08:00">
                2020-05-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>第一次写文章，用作个人记录和分享交流，不好之处还请谅解。因本人喜爱吃都城(健康)，在公司叫的外卖都是都城，然后越来越多人跟着我点，而且每次都是我去统计人数，每个人点餐详情，我都是通过企业微信最后汇总到txt文本上再去打电话叫外卖，最后跟都城工作人员确认防止多点少点(真是一把辛酸泪，谁让我这么伟大呢?)。后来本人觉得太麻烦了，便抽了点时间去开发一个专为都城点餐的PC端系统，主要为了方便自己。</p>
<h1 id="涉及功能点"><a href="#涉及功能点" class="headerlink" title="涉及功能点"></a>涉及功能点</h1><ol>
<li>登录注册修改账号密码</li>
<li>查看订餐列表</li>
<li>点餐功能</li>
<li>简单聊天功能</li>
<li>评论功能</li>
<li>点赞功能</li>
<li>删除评论功能</li>
<li>查看当天所有订单详情功能<h1 id="项目图片"><a href="#项目图片" class="headerlink" title="项目图片"></a>项目图片</h1><blockquote>
<p>首页<br>![图片描述][1]<br>菜单列表页<br>![图片描述][2]<br>聊天页<br>![图片描述][3]</p>
</blockquote>
<h1 id="项目地址"><a href="#项目地址" class="headerlink" title="项目地址"></a>项目地址</h1>github: <a href="https://github.com/FEA-Dven/ducheng" target="_blank" rel="noopener">https://github.com/FEA-Dven/ducheng</a></li>
</ol>
<p>线上: <a href="https://dywsweb.com/food/login" target="_blank" rel="noopener">https://dywsweb.com/food/login</a>  (账号:admin, 密码:123)</p>
<h1 id="技术栈"><a href="#技术栈" class="headerlink" title="技术栈"></a>技术栈</h1><p>前端: react + antd </p>
<p>后端: nodejs + koa2</p>
<h1 id="目录介绍"><a href="#目录介绍" class="headerlink" title="目录介绍"></a>目录介绍</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">|---ducheng                                 最外层项目目录 </span><br><span class="line">    |---fontend                             前端项目</span><br><span class="line">        |---app                             主要项目代码 </span><br><span class="line">            |---api                         请求api</span><br><span class="line">            |---assets                      资源管理</span><br><span class="line">            |---libs                        包含公用函数</span><br><span class="line">            |---model                       redux状态管理  </span><br><span class="line">            |---router                      前端路由</span><br><span class="line">            |---style                       前端样式</span><br><span class="line">            |---views                       前端页面组件</span><br><span class="line">                |---chat                    聊天页</span><br><span class="line">                |---component               前端组件</span><br><span class="line">                |---index                   订餐系统首页</span><br><span class="line">                |---login                   登录页</span><br><span class="line">                |---App.js              </span><br><span class="line">            |---config.js                   前端域名配置</span><br><span class="line">            |---main.js                     项目主函数</span><br><span class="line">        |---fontserver                      前端服务</span><br><span class="line">            |---config                      前端服务配置</span><br><span class="line">            |---controller                  前端服务控制层</span><br><span class="line">            |---router                      前端服务路由</span><br><span class="line">            |---utils                       前端服务公用库</span><br><span class="line">            |---views                       前端服务渲染模板</span><br><span class="line">            |---app.js                      前端服务主函数</span><br><span class="line">        |---node_modules        </span><br><span class="line">        |---.babelrc            </span><br><span class="line">        |---.gitignore      </span><br><span class="line">        |---gulpfile.js          </span><br><span class="line">        |---package.json</span><br><span class="line">        |---pm2.prod.json                   构建线上的前端服务pm2配置</span><br><span class="line">        |---README.md      </span><br><span class="line">        |---webpack.config.js               构建配置</span><br><span class="line">    |---backend                             后台项目</span><br><span class="line">        |---app                             主要项目代码 </span><br><span class="line">            |---controller                  控制层</span><br><span class="line">            |---model                       模型层(操作数据库)</span><br><span class="line">            |---service                     服务层</span><br><span class="line">            |---route                       路由</span><br><span class="line">            |---validation                  参数校验</span><br><span class="line">        |---config                          服务配置参数</span><br><span class="line">        |---library                         定义类库</span><br><span class="line">        |---logs                            存放日志</span><br><span class="line">        |---middleware                      中间件</span><br><span class="line">        |---node_modules                 </span><br><span class="line">        |---sql                             数据库sql语句在这里</span><br><span class="line">        |---util                            公共函数库</span><br><span class="line">        |---app.js                          项目主函数</span><br><span class="line">        |---package.json</span><br></pre></td></tr></table></figure>

<h1 id="前端项目小结"><a href="#前端项目小结" class="headerlink" title="前端项目小结"></a>前端项目小结</h1><h2 id="1、搭建自己的服务"><a href="#1、搭建自己的服务" class="headerlink" title="1、搭建自己的服务"></a>1、搭建自己的服务</h2><ol>
<li>项目没有用到脚手架，而是自己搭建前端服务器，也是koa2框架。通过koa2解析webpack配置，通过webpack打包生成资源，然后前端服务将资源引入到xtpl中达到渲染效果。</li>
<li>搭建自己的服务器也有好处，可以解决跨域问题，或者通过node作为中间层请求后台服务器。嗯，本项目这些好处都没有用到。<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (isDev) &#123;</span><br><span class="line">    <span class="comment">// koawebpack模快</span></span><br><span class="line">    <span class="keyword">let</span> koaWebpack = <span class="built_in">require</span>(<span class="string">'koa-webpack-middleware'</span>)</span><br><span class="line">    <span class="keyword">let</span> devMiddleware = koaWebpack.devMiddleware</span><br><span class="line">    <span class="keyword">let</span> hotMiddleware = koaWebpack.hotMiddleware</span><br><span class="line">    <span class="keyword">let</span> clientCompiler = <span class="built_in">require</span>(<span class="string">'webpack'</span>)(webpackConfig)</span><br><span class="line">    app.use(devMiddleware(clientCompiler, &#123;</span><br><span class="line">        stats: &#123;</span><br><span class="line">            colors: <span class="literal">true</span></span><br><span class="line">        &#125;,</span><br><span class="line">        publicPath: webpackConfig.output.publicPath,</span><br><span class="line">    &#125;))</span><br><span class="line">    app.use(hotMiddleware(clientCompiler))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">app.use(<span class="keyword">async</span> <span class="function"><span class="keyword">function</span>(<span class="params">ctx, next</span>) </span>&#123; <span class="comment">//设置环境和打包资源路径</span></span><br><span class="line">    <span class="keyword">if</span> (isDev) &#123;</span><br><span class="line">        <span class="keyword">let</span> assets =&#123;&#125;</span><br><span class="line">        <span class="keyword">const</span> publicPath = webpackConfig.output.publicPath</span><br><span class="line">        assets.food = &#123; <span class="attr">js</span> : publicPath + <span class="string">`food.js`</span> &#125;</span><br><span class="line">        ctx.assets = assets</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        ctx.assets = <span class="built_in">require</span>(<span class="string">'../build/assets.json'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">await</span> next()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="2、引入HappyPack快速打包"><a href="#2、引入HappyPack快速打包" class="headerlink" title="2、引入HappyPack快速打包"></a>2、引入HappyPack快速打包</h2><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const happyThreadPool = HappyPack.<span class="constructor">ThreadPool(&#123; <span class="params">size</span>: <span class="params">os</span>.<span class="params">cpus</span>()</span>.length<span class="operator"> / </span><span class="number">2</span> &#125;); <span class="comment">//根据CPU线程数创建线程池</span></span><br></pre></td></tr></table></figure>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">plugins: [</span><br><span class="line">    <span class="built_in">new</span> HappyPack(&#123;</span><br><span class="line">      id: <span class="string">'happyBabel'</span>,</span><br><span class="line">      loaders: [&#123;</span><br><span class="line">        loader: <span class="string">'babel-loader?cacheDirectory=true'</span>,</span><br><span class="line">      &#125;],</span><br><span class="line">      threadPool: happyThreadPool,</span><br><span class="line">      <span class="keyword">verbose</span>: <span class="keyword">true</span>,</span><br><span class="line">    &#125;),</span><br><span class="line">    <span class="built_in">new</span> webpack.DefinePlugin(&#123;</span><br><span class="line">      "process.env.NODE_ENV": <span class="type">JSON</span>.stringify(env),</span><br><span class="line">    &#125;)</span><br><span class="line">].concat(isDev?[ </span><br><span class="line">    <span class="built_in">new</span> webpack.HotModuleReplacementPlugin(),</span><br><span class="line">]:[</span><br><span class="line">    <span class="built_in">new</span> AssetsPlugin(&#123;filename: <span class="string">'./build/assets.json'</span>&#125;),</span><br><span class="line">    <span class="built_in">new</span> webpack.optimize.ModuleConcatenationPlugin(),</span><br><span class="line">    <span class="built_in">new</span> MiniCssExtractPlugin(&#123;</span><br><span class="line">        filename: <span class="string">'[name].[hash:8].css'</span>,</span><br><span class="line">        chunkFilename: "[id].[hash:8].css"</span><br><span class="line">    &#125;),</span><br><span class="line">]),</span><br></pre></td></tr></table></figure>
<h3 id="3、封装路由组件用作权限校验"><a href="#3、封装路由组件用作权限校验" class="headerlink" title="3、封装路由组件用作权限校验"></a>3、封装路由组件用作权限校验</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">function requireAuthentication(Component) &#123;</span><br><span class="line">    <span class="comment">// 组件有已登陆的模块 直接返回 (防止从新渲染)</span></span><br><span class="line">    <span class="keyword">if</span> (Component.AuthenticatedComponent) &#123;</span><br><span class="line">        <span class="keyword">return</span> Component.AuthenticatedComponent</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 创建验证组件</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">AuthenticatedComponent</span> <span class="title">extends</span> <span class="title">React</span>.<span class="title">Component</span> </span>&#123;</span><br><span class="line">        state = &#123;</span><br><span class="line">            login: <span class="literal">true</span>,</span><br><span class="line">        &#125;</span><br><span class="line">        componentWillMount() &#123;</span><br><span class="line">            <span class="keyword">this</span>.checkAuth();</span><br><span class="line">        &#125;</span><br><span class="line">        componentWillReceiveProps(nextProps) &#123;</span><br><span class="line">            <span class="keyword">this</span>.checkAuth();</span><br><span class="line">        &#125;</span><br><span class="line">        checkAuth() &#123;</span><br><span class="line">            <span class="comment">// 未登陆重定向到登陆页面</span></span><br><span class="line">            let login = UTIL.shouldRedirectToLogin();</span><br><span class="line">            <span class="keyword">if</span> (login) &#123;</span><br><span class="line">                window.location.href = <span class="string">'/food/login'</span>;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">this</span>.setState(&#123; login: !login &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        render() &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.state.login) &#123;</span><br><span class="line">                <span class="keyword">return</span> &lt;Component &#123;...<span class="keyword">this</span>.props&#125; /&gt;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">''</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> AuthenticatedComponent</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>思路:这个权限校验的组件将其他组件设为参数传入，当加载页面的时候，权限校验组件会先进行权限校验，当浏览器没有cookie指定的参数时，直接返回登录页</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Provider</span> <span class="attr">store</span>=<span class="string">&#123;store&#125;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Router</span> <span class="attr">history</span>=<span class="string">&#123;browserHistory&#125;</span> &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Switch</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">"/food/login"</span> <span class="attr">exact</span> <span class="attr">component</span>=<span class="string">&#123;Login&#125;/</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">"/food/index"</span> <span class="attr">component</span>=<span class="string">&#123;requireAuthentication(Index)&#125;/</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Route</span> <span class="attr">path</span>=<span class="string">"/food/chat"</span> <span class="attr">component</span>=<span class="string">&#123;requireAuthentication(Chat)&#125;/</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Route</span> <span class="attr">component</span>=<span class="string">&#123;Nomatchpage&#125;/</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">Switch</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Router</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Provider</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="4、通过webpack设置主题色"><a href="#4、通过webpack设置主题色" class="headerlink" title="4、通过webpack设置主题色"></a>4、通过webpack设置主题色</h3><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attribute">test</span>: /\.less|\.css$/,</span><br><span class="line">    use: [</span><br><span class="line">        &#123;</span><br><span class="line">            loader: isDev ? <span class="string">'style-loader'</span> : MiniCssExtractPlugin.loader</span><br><span class="line">        &#125;, &#123;</span><br><span class="line">            <span class="attribute">loader</span>: <span class="string">"css-loader"</span></span><br><span class="line">        &#125;, &#123;</span><br><span class="line">            <span class="attribute">loader</span>: <span class="string">"less-loader"</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">                javascriptEnabled: true,</span><br><span class="line">                modifyVars: &#123;</span><br><span class="line">                    <span class="string">'primary-color'</span>: <span class="string">'#0089ce'</span>,</span><br><span class="line">                    <span class="string">'link-color'</span>: <span class="string">'#0089ce'</span></span><br><span class="line">                &#125;,</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="5、其他"><a href="#5、其他" class="headerlink" title="5、其他"></a>5、其他</h3></li>
<li>网页保存cookie的用户id，请求时放入header带去服务器，识别哪个用户操作</li>
<li>每个页面都是零散的组件拼起来，所以组件之间的数据要处理好</li>
</ol>
<h1 id="后端项目小结"><a href="#后端项目小结" class="headerlink" title="后端项目小结"></a>后端项目小结</h1><h3 id="框架设计"><a href="#框架设计" class="headerlink" title="框架设计"></a>框架设计</h3><blockquote>
<p>主要分为 controller层, service层, model层。</p>
</blockquote>
<ol>
<li>controller层作用于接收参数，然后做参数校验，再将参数传入到service层做业务逻辑</li>
<li>service层做业务逻辑</li>
<li>model层调用数据库<h3 id="数据库详情"><a href="#数据库详情" class="headerlink" title="数据库详情"></a>数据库详情</h3></li>
<li>数据库用的是mysql</li>
<li>查询数据库用的是SQL查询构建器Knex<figure class="highlight roboconf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">this.readMysql = new Knex(&#123;</span><br><span class="line">    <span class="attribute">client</span>: 'mysql',</span><br><span class="line">    debug: dbConfig<span class="variable">.plat_read_mysql</span><span class="variable">.debug</span>,</span><br><span class="line">    connection: &#123;</span><br><span class="line">        host: dbConfig<span class="variable">.plat_read_mysql</span><span class="variable">.host</span>,</span><br><span class="line">        user: dbConfig<span class="variable">.plat_read_mysql</span><span class="variable">.user</span>,</span><br><span class="line">        password: dbConfig<span class="variable">.plat_read_mysql</span><span class="variable">.password</span>,</span><br><span class="line">        database: dbConfig<span class="variable">.plat_read_mysql</span><span class="variable">.database</span>,</span><br><span class="line">        timezone: dbConfig<span class="variable">.plat_read_mysql</span><span class="variable">.timezone</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    pool: &#123;</span><br><span class="line">        min: dbConfig<span class="variable">.plat_read_mysql</span><span class="variable">.minConnection</span>,</span><br><span class="line">        max: dbConfig<span class="variable">.plat_read_mysql</span><span class="variable">.maxConnection</span></span><br><span class="line">    &#125;,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="attribute">this.writeMysql = new Knex(&#123;</span></span><br><span class="line"><span class="attribute">    client</span>: 'mysql',</span><br><span class="line">    debug: dbConfig<span class="variable">.plat_write_mysql</span><span class="variable">.debug</span>,</span><br><span class="line">    connection: &#123;</span><br><span class="line">        host: dbConfig<span class="variable">.plat_write_mysql</span><span class="variable">.host</span>,</span><br><span class="line">        user: dbConfig<span class="variable">.plat_write_mysql</span><span class="variable">.user</span>,</span><br><span class="line">        password: dbConfig<span class="variable">.plat_write_mysql</span><span class="variable">.password</span>,</span><br><span class="line">        database: dbConfig<span class="variable">.plat_write_mysql</span><span class="variable">.database</span>,</span><br><span class="line">        timezone: dbConfig<span class="variable">.plat_write_mysql</span><span class="variable">.timezone</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    pool: &#123;</span><br><span class="line">        min: dbConfig<span class="variable">.plat_write_mysql</span><span class="variable">.minConnection</span>,</span><br><span class="line">        max: dbConfig<span class="variable">.plat_write_mysql</span><span class="variable">.maxConnection</span></span><br><span class="line">    &#125;,</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li>
<li>上面代码用了两个查询构造器区分写入数据库动作和读取数据库动作<h3 id="写一个鉴权的中间件"><a href="#写一个鉴权的中间件" class="headerlink" title="写一个鉴权的中间件"></a>写一个鉴权的中间件</h3><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">checkHeader: async <span class="keyword">function</span>(ctx, next) &#123;</span><br><span class="line">    await validator.validate(</span><br><span class="line">        ctx.headerInput,</span><br><span class="line">        userValidation.checkHeader.schema,</span><br><span class="line">        userValidation.checkHeader.options</span><br><span class="line">    )</span><br><span class="line">    <span class="keyword">let</span> cacheUserInfo = await db.redis.get(foodKeyDefines.user<span class="constructor">InfoCacheKey(<span class="params">ctx</span>.<span class="params">headerInput</span>.<span class="params">fid</span>)</span>)</span><br><span class="line">    cacheUserInfo = <span class="module-access"><span class="module"><span class="identifier">UTIL</span>.</span></span>json<span class="constructor">Parse(<span class="params">cacheUserInfo</span>)</span>;</span><br><span class="line">    <span class="comment">// 如果没有redis层用户信息和token信息不对称，需要用户重新登录</span></span><br><span class="line">    <span class="keyword">if</span> (!cacheUserInfo<span class="operator"> || </span>ctx.headerInput.token !== cacheUserInfo.token) &#123;</span><br><span class="line">        throw <span class="keyword">new</span> <span class="constructor">ApiError('<span class="params">food</span>.<span class="params">userAccessTokenForbidden</span>')</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    await next<span class="literal">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>使用鉴权中间件，拿一个路由作为例子</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//引入</span></span><br><span class="line"><span class="keyword">const</span> routePermission = <span class="built_in">require</span>(<span class="string">'../../middleware/routePermission.js'</span>);</span><br><span class="line"><span class="comment">// 用户点餐</span></span><br><span class="line">router.post(<span class="string">'/api/user/order'</span>, routePermission.checkHeader, userMenuController.userOrder);</span><br></pre></td></tr></table></figure>
<h3 id="请求错误码封装"><a href="#请求错误码封装" class="headerlink" title="请求错误码封装"></a>请求错误码封装</h3><blockquote>
<p>定义一个请求错误类</p>
</blockquote>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ApiError</span> <span class="keyword">extends</span> <span class="title">Error</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 构造方法</span></span><br><span class="line"><span class="comment">     * @param errorName 错误名称</span></span><br><span class="line"><span class="comment">     * @param params 错误信息参数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    constructor(errorName, ...params) &#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">        let errorInfo = apiErrorDefines(errorName, params);</span><br><span class="line">        <span class="keyword">this</span>.name = errorName;</span><br><span class="line">        <span class="keyword">this</span>.code = errorInfo.code;</span><br><span class="line">        <span class="keyword">this</span>.status = errorInfo.status;</span><br><span class="line">        <span class="keyword">this</span>.message = errorInfo.message;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>错误码定义</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">const</span> <span class="string">defines</span> <span class="string">=</span> <span class="string">&#123;</span></span><br><span class="line">    <span class="attr">'common.all':</span> <span class="string">&#123;code:</span> <span class="number">1000</span><span class="string">,</span> <span class="attr">message:</span> <span class="string">'%s'</span><span class="string">,</span> <span class="attr">status:</span> <span class="number">500</span><span class="string">&#125;,</span></span><br><span class="line">    <span class="attr">'request.paramError':</span> <span class="string">&#123;code:</span> <span class="number">1001</span><span class="string">,</span> <span class="attr">message:</span> <span class="string">'参数错误 %s'</span><span class="string">,</span> <span class="attr">status:</span> <span class="number">200</span><span class="string">&#125;,</span></span><br><span class="line">    <span class="attr">'access.forbidden':</span> <span class="string">&#123;code:</span> <span class="number">1010</span><span class="string">,</span> <span class="attr">message:</span> <span class="string">'没有操作权限'</span><span class="string">,</span> <span class="attr">status:</span> <span class="number">403</span><span class="string">&#125;,</span></span><br><span class="line">    <span class="attr">'auth.notPermission':</span> <span class="string">&#123;code:</span> <span class="number">1011</span><span class="string">,</span> <span class="attr">message:</span> <span class="string">'授权失败 %s'</span><span class="string">,</span> <span class="attr">status:</span> <span class="number">403</span><span class="string">&#125;,</span></span><br><span class="line">    <span class="attr">'role.notExist':</span> <span class="string">&#123;code:</span> <span class="number">1012</span><span class="string">,</span> <span class="attr">message:</span> <span class="string">'角色不存在'</span><span class="string">,</span> <span class="attr">status:</span> <span class="number">403</span><span class="string">&#125;,</span></span><br><span class="line">    <span class="attr">'auth.codeExpired':</span> <span class="string">&#123;code:</span> <span class="number">1013</span><span class="string">,</span> <span class="attr">message:</span> <span class="string">'授权码已失效'</span><span class="string">,</span> <span class="attr">status:</span> <span class="number">403</span><span class="string">&#125;,</span></span><br><span class="line">    <span class="attr">'auth.codeError':</span> <span class="string">&#123;code:</span> <span class="number">1014</span><span class="string">,</span> <span class="attr">message:</span> <span class="string">'授权码错误'</span><span class="string">,</span> <span class="attr">status:</span> <span class="number">403</span><span class="string">&#125;,</span></span><br><span class="line">    <span class="attr">'auth.pargramNotExist':</span> <span class="string">&#123;code:</span> <span class="number">1015</span><span class="string">,</span> <span class="attr">message:</span> <span class="string">'程序不存在'</span><span class="string">,</span> <span class="attr">status:</span> <span class="number">403</span><span class="string">&#125;,</span></span><br><span class="line">    <span class="attr">'auth.pargramSecretError':</span> <span class="string">&#123;code:</span> <span class="number">1016</span><span class="string">,</span> <span class="attr">message:</span> <span class="string">'程序秘钥错误'</span><span class="string">,</span> <span class="attr">status:</span> <span class="number">403</span><span class="string">&#125;,</span></span><br><span class="line">    <span class="attr">'auth.pargramSecretEmpty':</span> <span class="string">&#123;code:</span> <span class="number">1016</span><span class="string">,</span> <span class="attr">message:</span> <span class="string">'程序秘钥为空，请后台配置'</span><span class="string">,</span> <span class="attr">status:</span> <span class="number">403</span><span class="string">&#125;,</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">'db.queryError':</span> <span class="string">&#123;</span> <span class="attr">code:</span> <span class="number">1100</span><span class="string">,</span> <span class="attr">message:</span> <span class="string">'数据库查询异常'</span><span class="string">,</span> <span class="attr">status:</span> <span class="number">500</span> <span class="string">&#125;,</span></span><br><span class="line">    <span class="attr">'db.insertError':</span> <span class="string">&#123;</span> <span class="attr">code:</span> <span class="number">1101</span><span class="string">,</span> <span class="attr">message:</span> <span class="string">'数据库写入异常'</span><span class="string">,</span> <span class="attr">status:</span> <span class="number">500</span> <span class="string">&#125;,</span></span><br><span class="line">    <span class="attr">'db.updateError':</span> <span class="string">&#123;</span> <span class="attr">code:</span> <span class="number">1102</span><span class="string">,</span> <span class="attr">message:</span> <span class="string">'数据库更新异常'</span><span class="string">,</span> <span class="attr">status:</span> <span class="number">500</span> <span class="string">&#125;,</span></span><br><span class="line">    <span class="attr">'db.deleteError':</span> <span class="string">&#123;</span> <span class="attr">code:</span> <span class="number">1103</span><span class="string">,</span> <span class="attr">message:</span> <span class="string">'数据库删除异常'</span><span class="string">,</span> <span class="attr">status:</span> <span class="number">500</span> <span class="string">&#125;,</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">'redis.setError':</span> <span class="string">&#123;</span> <span class="attr">code:</span> <span class="number">1104</span><span class="string">,</span> <span class="attr">message:</span> <span class="string">'redis设置异常'</span><span class="string">,</span> <span class="attr">status:</span> <span class="number">500</span> <span class="string">&#125;,</span></span><br><span class="line"></span><br><span class="line">    <span class="string">'food.illegalUser'</span> <span class="string">:</span> <span class="string">&#123;code:</span> <span class="number">1201</span><span class="string">,</span> <span class="attr">message:</span> <span class="string">'非法用户'</span><span class="string">,</span> <span class="attr">status:</span> <span class="number">403</span><span class="string">&#125;,</span></span><br><span class="line">    <span class="string">'food.userHasExist'</span> <span class="string">:</span> <span class="string">&#123;code:</span> <span class="number">1202</span><span class="string">,</span> <span class="attr">message:</span> <span class="string">'用户已经存在'</span><span class="string">,</span> <span class="attr">status:</span> <span class="number">200</span><span class="string">&#125;,</span></span><br><span class="line">    <span class="string">'food.objectNotExist'</span> <span class="string">:</span> <span class="string">&#123;code:</span> <span class="number">1203</span><span class="string">,</span> <span class="attr">message:</span> <span class="string">'%s'</span><span class="string">,</span> <span class="attr">status:</span> <span class="number">200</span><span class="string">&#125;,</span></span><br><span class="line">    <span class="attr">'food.insertMenuError':</span> <span class="string">&#123;code:</span> <span class="number">1204</span><span class="string">,</span> <span class="attr">message:</span> <span class="string">'批量插入菜单失败'</span><span class="string">,</span> <span class="attr">status:</span> <span class="number">200</span><span class="string">&#125;,</span></span><br><span class="line">    <span class="attr">'food.userNameInvalid':</span> <span class="string">&#123;code:</span> <span class="number">1205</span><span class="string">,</span> <span class="attr">message:</span> <span class="string">'我不信你叫这个名字'</span><span class="string">,</span> <span class="attr">status:</span> <span class="number">200</span><span class="string">&#125;,</span></span><br><span class="line">    <span class="attr">'food.userOrderAlready':</span> <span class="string">&#123;code:</span> <span class="number">1206</span><span class="string">,</span> <span class="attr">message:</span> <span class="string">'您已经定过餐了'</span><span class="string">,</span> <span class="attr">status:</span> <span class="number">200</span><span class="string">&#125;,</span></span><br><span class="line">    <span class="attr">'food.userNotOrderToday':</span> <span class="string">&#123;code:</span> <span class="number">1207</span><span class="string">,</span> <span class="attr">message:</span> <span class="string">'您今天还没有订餐'</span><span class="string">,</span> <span class="attr">status:</span> <span class="number">200</span><span class="string">&#125;,</span></span><br><span class="line">    <span class="attr">'food.orderIsEnd':</span> <span class="string">&#123;code:</span> <span class="number">1208</span><span class="string">,</span> <span class="attr">message:</span> <span class="string">'订餐已经截止了，欢迎下次光临'</span><span class="string">,</span> <span class="attr">status:</span> <span class="number">200</span><span class="string">&#125;,</span></span><br><span class="line">    <span class="attr">'food.blackHouse':</span> <span class="string">&#123;code:</span> <span class="number">1209</span><span class="string">,</span> <span class="attr">message:</span> <span class="string">'别搞太多骚操作'</span><span class="string">,</span> <span class="attr">status:</span> <span class="number">200</span><span class="string">&#125;,</span></span><br><span class="line">    <span class="attr">'food.userAccessTokenForbidden':</span> <span class="string">&#123;</span> <span class="attr">code:</span> <span class="number">1210</span><span class="string">,</span> <span class="attr">message:</span> <span class="string">'token失效'</span><span class="string">,</span> <span class="attr">status:</span> <span class="number">403</span> <span class="string">&#125;,</span></span><br><span class="line">    <span class="attr">'food.userHasStared':</span> <span class="string">&#123;</span> <span class="attr">code:</span> <span class="number">1211</span><span class="string">,</span> <span class="attr">message:</span> <span class="string">'此评论您已点过赞'</span><span class="string">,</span> <span class="attr">status:</span> <span class="number">200</span> <span class="string">&#125;,</span></span><br><span class="line">    <span class="attr">'food.canNotReplySelf':</span> <span class="string">&#123;</span> <span class="attr">code:</span> <span class="number">1212</span><span class="string">,</span> <span class="attr">message:</span> <span class="string">'不能回复自己的评论'</span><span class="string">,</span> <span class="attr">status:</span> <span class="number">200</span> <span class="string">&#125;,</span></span><br><span class="line">    <span class="attr">'food.overReplyLimit':</span> <span class="string">&#123;</span> <span class="attr">code:</span> <span class="number">1213</span><span class="string">,</span> <span class="attr">message:</span> <span class="string">'回复评论数已超过%s条，不能再回复'</span><span class="string">,</span> <span class="attr">status:</span> <span class="number">200</span> <span class="string">&#125;</span></span><br><span class="line"><span class="string">&#125;;</span></span><br><span class="line"></span><br><span class="line"><span class="string">module.exports</span> <span class="string">=</span> <span class="string">function</span> <span class="string">(errorName,</span> <span class="string">params)</span> <span class="string">&#123;</span></span><br><span class="line">    <span class="string">if(defines[errorName])</span> <span class="string">&#123;</span></span><br><span class="line">        <span class="string">let</span> <span class="string">result</span> <span class="string">=</span> <span class="string">&#123;</span></span><br><span class="line">            <span class="attr">code:</span> <span class="string">defines[errorName].code,</span></span><br><span class="line">            <span class="attr">message:</span> <span class="string">defines[errorName].message,</span></span><br><span class="line">            <span class="attr">status:</span> <span class="string">defines[errorName].status</span></span><br><span class="line">        <span class="string">&#125;;</span></span><br><span class="line"></span><br><span class="line">        <span class="string">params.forEach(element</span> <span class="string">=&gt;</span> <span class="string">&#123;</span></span><br><span class="line">            <span class="string">result.message</span> <span class="string">=</span> <span class="string">(result.message).replace('%s',</span> <span class="string">element);</span></span><br><span class="line">        <span class="string">&#125;);</span></span><br><span class="line"></span><br><span class="line">        <span class="string">return</span> <span class="string">result;</span></span><br><span class="line">    <span class="string">&#125;</span></span><br><span class="line">    </span><br><span class="line">    <span class="string">return</span> <span class="string">&#123;</span></span><br><span class="line">        <span class="attr">code:</span> <span class="number">1000</span><span class="string">,</span></span><br><span class="line">        <span class="attr">message:</span> <span class="string">'服务器内部错误'</span><span class="string">,</span></span><br><span class="line">        <span class="attr">status:</span> <span class="number">500</span></span><br><span class="line">    <span class="string">&#125;;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="抛错机制"><a href="#抛错机制" class="headerlink" title="抛错机制"></a>抛错机制</h3>当程序判断到有错误产生时，可以抛出错误给到前端，例如token不正确。<figure class="highlight haxe"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 如果没有redis层用户信息和token信息不对称，需要用户重新登录</span></span><br><span class="line"><span class="keyword">if</span> (!cacheUserInfo || ctx.headerInput.token !== cacheUserInfo.token) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="type">ApiError</span>(<span class="string">'food.userAccessTokenForbidden'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>因为程序有一个回调处理的中间件，所以能捕捉到定义的ApiError</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// requestError.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> (<span class="params">ctx, next</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> beginTime = <span class="keyword">new</span> <span class="built_in">Date</span>().getTime();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">await</span> next();</span><br><span class="line">        <span class="keyword">let</span> req = ctx.request;</span><br><span class="line">        <span class="keyword">let</span> res = ctx.response;</span><br><span class="line">        <span class="keyword">let</span> input = ctx.input;</span><br><span class="line">        <span class="keyword">let</span> endTime = <span class="keyword">new</span> <span class="built_in">Date</span>().getTime();</span><br><span class="line">        <span class="keyword">let</span> ip = req.get(<span class="string">"X-Real-IP"</span>) || req.get(<span class="string">"X-Forwarded-For"</span>) || req.ip;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> fields = &#123;</span><br><span class="line">            status: res.status,</span><br><span class="line">            accept: req.header[<span class="string">'accept'</span>],</span><br><span class="line">            cookie: req.header[<span class="string">'cookie'</span>],</span><br><span class="line">            ua: req.header[<span class="string">'user-agent'</span>],</span><br><span class="line">            method: req.method,</span><br><span class="line">            headers: ctx.headers,</span><br><span class="line">            url: req.url,</span><br><span class="line">            client_ip: ip,</span><br><span class="line">            cost: endTime - beginTime,</span><br><span class="line">            input: input</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        logger.getLogger(<span class="string">'access'</span>).trace(<span class="string">'requestSuccess'</span>, fields);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        <span class="keyword">if</span> (e.code === <span class="string">'ECONNREFUSED'</span>) &#123;</span><br><span class="line">            <span class="comment">//数据库连接失败</span></span><br><span class="line">            logger.getLogger(<span class="string">'error'</span>).fatal(<span class="string">'mysql连接失败'</span>, e.message, e.code);</span><br><span class="line">            e.code = <span class="number">1</span>;</span><br><span class="line">            e.message = <span class="string">'数据库连接异常'</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (e.code === <span class="string">'ER_DUP_ENTRY'</span>) &#123;</span><br><span class="line">            logger.getLogger(<span class="string">'error'</span>).error(<span class="string">'mysql操作异常'</span>, e.message, e.code);</span><br><span class="line">            e.code = <span class="number">1</span>;</span><br><span class="line">            e.message = <span class="string">'数据库操作违反唯一约束'</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (e.code === <span class="string">'ETIMEDOUT'</span>) &#123;</span><br><span class="line">            logger.getLogger(<span class="string">'error'</span>).error(<span class="string">'mysql操作异常'</span>, e.message, e.code);</span><br><span class="line">            e.code = <span class="number">1</span>;</span><br><span class="line">            e.message = <span class="string">'数据库连接超时'</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> req = ctx.request;</span><br><span class="line">        <span class="keyword">let</span> res = ctx.response;</span><br><span class="line">        <span class="keyword">let</span> status = e.status || <span class="number">500</span>;</span><br><span class="line">        <span class="keyword">let</span> msg = e.message || e;</span><br><span class="line">        <span class="keyword">let</span> input = ctx.input;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> endTime = <span class="keyword">new</span> <span class="built_in">Date</span>().getTime();</span><br><span class="line">        <span class="keyword">let</span> ip = req.get(<span class="string">"X-Real-IP"</span>) || req.get(<span class="string">"X-Forwarded-For"</span>) || req.ip;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> fields = &#123;</span><br><span class="line">            status: res.status,</span><br><span class="line">            accept: req.header[<span class="string">'accept'</span>],</span><br><span class="line">            cookie: req.header[<span class="string">'cookie'</span>],</span><br><span class="line">            ua: req.header[<span class="string">'user-agent'</span>],</span><br><span class="line">            method: req.method,</span><br><span class="line">            headers: ctx.headers,</span><br><span class="line">            url: req.url,</span><br><span class="line">            client_ip: ip,</span><br><span class="line">            cost: endTime - beginTime,</span><br><span class="line">            input: input,</span><br><span class="line">            msg: msg</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        ctx.status = status;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (status === <span class="number">500</span>) &#123;</span><br><span class="line">            logger.getLogger(<span class="string">'access'</span>).error(<span class="string">'requestError'</span>, fields);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            logger.getLogger(<span class="string">'access'</span>).warn(<span class="string">'requestException'</span>, fields);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">let</span> errCode = e.code || <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (!(<span class="built_in">parseInt</span>(errCode) &gt; <span class="number">0</span>)) &#123;</span><br><span class="line">            errCode = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> response.output(ctx, &#123;&#125;, errCode, msg, status);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>在app.js中引入中间件</p>
</blockquote>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 请求回调处理中间件</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">app.use(<span class="keyword">require</span>(<span class="string">'./middleware/requestError.js'</span>));</span><br></pre></td></tr></table></figure>
<h3 id="数据库创建sql-命名不规范，请见谅"><a href="#数据库创建sql-命名不规范，请见谅" class="headerlink" title="数据库创建sql(命名不规范，请见谅)"></a>数据库创建sql(命名不规范，请见谅)</h3><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">CREATE DATABASE food_program;</span><br><span class="line">USE food_program;</span><br><span class="line"><span class="comment"># 用户表</span></span><br><span class="line">CREATE TABLE t_food_user(</span><br><span class="line">    fid int(11) auto_increment primary key COMMENT <span class="string">'用户id'</span>,</span><br><span class="line">    account varchar(255) <span class="keyword">NOT</span> <span class="literal">NULL</span> COMMENT <span class="string">'用户昵称'</span>,</span><br><span class="line">    password varchar(255) <span class="keyword">NOT</span> <span class="literal">NULL</span> COMMENT <span class="string">'用户密码'</span>,</span><br><span class="line">    role TINYINT(2)<span class="built_in"> DEFAULT </span>0 COMMENT <span class="string">'用户角色(项目关系，没有用关联表)'</span>,</span><br><span class="line">    create_time BIGINT(20)<span class="built_in"> DEFAULT </span>0 <span class="keyword">NOT</span> <span class="literal">NULL</span> COMMENT <span class="string">'创建时间'</span>,</span><br><span class="line">    update_time BIGINT(20)<span class="built_in"> DEFAULT </span>0 <span class="keyword">NOT</span> <span class="literal">NULL</span> COMMENT <span class="string">'修改时间'</span>,</span><br><span class="line">    status TINYINT(2)<span class="built_in"> DEFAULT </span>1 <span class="keyword">NOT</span> <span class="literal">NULL</span> COMMENT <span class="string">'状态 0:删除, 1:正常'</span>,</span><br><span class="line">    UNIQUE KEY `uidx_fid_user_name` (`fid`,`account`) USING BTREE</span><br><span class="line">)ENGINE = InnoDB<span class="built_in"> DEFAULT </span>CHARSET = utf8mb4 COMMENT = <span class="string">'food 用户表'</span> ;</span><br><span class="line"></span><br><span class="line">CREATE TABLE t_food_menu(</span><br><span class="line">    menu_id int(11) auto_increment primary key COMMENT <span class="string">'菜单id'</span>,</span><br><span class="line">    menu_name varchar(255) <span class="keyword">NOT</span> <span class="literal">NULL</span> COMMENT <span class="string">'菜单昵称'</span>,</span><br><span class="line">   <span class="built_in"> type </span>TINYINT(2)<span class="built_in"> DEFAULT </span>0 <span class="keyword">NOT</span> <span class="literal">NULL</span> COMMENT <span class="string">'状态 0:每日菜单, 1:常规, 2:明炉烧腊'</span>,</span><br><span class="line">    price int(11) <span class="keyword">NOT</span> <span class="literal">NULL</span> COMMENT <span class="string">'价格'</span>,</span><br><span class="line">    status TINYINT(2)<span class="built_in"> DEFAULT </span>1 <span class="keyword">NOT</span> <span class="literal">NULL</span> COMMENT <span class="string">'状态 0:删除, 1:正常'</span>,</span><br><span class="line">    create_time BIGINT(20)<span class="built_in"> DEFAULT </span>0 <span class="keyword">NOT</span> <span class="literal">NULL</span> COMMENT <span class="string">'创建时间'</span>,</span><br><span class="line">    update_time BIGINT(20)<span class="built_in"> DEFAULT </span>0 <span class="keyword">NOT</span> <span class="literal">NULL</span> COMMENT <span class="string">'修改时间'</span>,</span><br><span class="line">    UNIQUE KEY `uidx_menu_id_menu_name` (`menu_id`,`menu_name`) USING BTREE,</span><br><span class="line">    UNIQUE KEY `uidx_menu_id_menu_name_type` (`menu_id`,`menu_name`,`type`) USING BTREE</span><br><span class="line">)ENGINE = InnoDB<span class="built_in"> DEFAULT </span>CHARSET = utf8mb4 COMMENT = <span class="string">'food 菜单列表'</span> ;</span><br><span class="line"></span><br><span class="line">CREATE TABLE t_food_user_menu_refs(</span><br><span class="line">    id int(11) auto_increment primary key COMMENT <span class="string">'记录id'</span>,</span><br><span class="line">    fid int(11) <span class="keyword">NOT</span> <span class="literal">NULL</span> COMMENT <span class="string">'用户id'</span>,</span><br><span class="line">    menu_id int(11) <span class="keyword">NOT</span> <span class="literal">NULL</span> COMMENT <span class="string">'菜单id'</span></span><br><span class="line">    create_time BIGINT(20)<span class="built_in"> DEFAULT </span>0 <span class="keyword">NOT</span> <span class="literal">NULL</span> COMMENT <span class="string">'创建时间'</span>,</span><br><span class="line">    update_time BIGINT(20)<span class="built_in"> DEFAULT </span>0 <span class="keyword">NOT</span> <span class="literal">NULL</span> COMMENT <span class="string">'修改时间'</span>,</span><br><span class="line">    status TINYINT(2)<span class="built_in"> DEFAULT </span>1 <span class="keyword">NOT</span> <span class="literal">NULL</span> COMMENT <span class="string">'状态 0:删除, 1:正常'</span>,</span><br><span class="line">    KEY `idx_fid_menu_id` (`fid`,`menu_id`) USING BTREE,</span><br><span class="line">    KEY `idx_fid_menu_id_status` (`fid`,`menu_id`,`status`) USING BTREE</span><br><span class="line">)ENGINE = InnoDB<span class="built_in"> DEFAULT </span>CHARSET = utf8mb4 COMMENT = <span class="string">'用户选择什么菜单'</span> ;</span><br><span class="line"></span><br><span class="line">CREATE TABLE t_food_system(</span><br><span class="line">    id int(11) auto_increment primary key COMMENT <span class="string">'系统id'</span>,</span><br><span class="line">    order_end TINYINT(2)<span class="built_in"> DEFAULT </span>0 <span class="keyword">NOT</span> <span class="literal">NULL</span> COMMENT <span class="string">'订单是否截止'</span>,</span><br><span class="line">    update_time BIGINT(20)<span class="built_in"> DEFAULT </span>0 <span class="keyword">NOT</span> <span class="literal">NULL</span> COMMENT <span class="string">'修改时间'</span></span><br><span class="line">)ENGINE = InnoDB<span class="built_in"> DEFAULT </span>CHARSET = utf8mb4 COMMENT = <span class="string">'都城订单系统'</span> ;</span><br><span class="line"></span><br><span class="line">CREATE TABLE t_food_comment(</span><br><span class="line">    comment_id int(11) auto_increment primary key COMMENT <span class="string">'评论id'</span>,</span><br><span class="line">    fid int(11) <span class="keyword">NOT</span> <span class="literal">NULL</span> COMMENT <span class="string">'用户id'</span>,</span><br><span class="line">    content TEXT COMMENT <span class="string">'评论内容'</span>,</span><br><span class="line">    star int(11)<span class="built_in"> DEFAULT </span>0 <span class="keyword">NOT</span> <span class="literal">NULL</span> COMMENT <span class="string">'点赞数'</span>,</span><br><span class="line">    create_time BIGINT(20)<span class="built_in"> DEFAULT </span>0 <span class="keyword">NOT</span> <span class="literal">NULL</span> COMMENT <span class="string">'创建时间'</span>,</span><br><span class="line">    update_time BIGINT(20)<span class="built_in"> DEFAULT </span>0 <span class="keyword">NOT</span> <span class="literal">NULL</span> COMMENT <span class="string">'修改时间'</span></span><br><span class="line">)ENGINE = InnoDB<span class="built_in"> DEFAULT </span>CHARSET = utf8mb4 COMMENT = <span class="string">'都城聊天表'</span> ;</span><br><span class="line"></span><br><span class="line">CREATE TABLE t_food_reply(</span><br><span class="line">    reply_id int(11) auto_increment primary key COMMENT <span class="string">'回复id'</span>,</span><br><span class="line">    reply_fid int(11) <span class="keyword">NOT</span> <span class="literal">NULL</span> COMMENT <span class="string">'回复用户fid'</span>,</span><br><span class="line">    comment_fid int(11) <span class="keyword">NOT</span> <span class="literal">NULL</span> COMMENT <span class="string">'评论用户fid'</span>,</span><br><span class="line">    content TEXT COMMENT <span class="string">'回复内容'</span>,</span><br><span class="line">    create_time BIGINT(20)<span class="built_in"> DEFAULT </span>0 <span class="keyword">NOT</span> <span class="literal">NULL</span> COMMENT <span class="string">'创建时间'</span>,</span><br><span class="line">    update_time BIGINT(20)<span class="built_in"> DEFAULT </span>0 <span class="keyword">NOT</span> <span class="literal">NULL</span> COMMENT <span class="string">'修改时间'</span>,</span><br><span class="line">    KEY `idx_reply_fid_comment_fid` (`reply_fid`,`comment_fid`) USING BTREE</span><br><span class="line">)ENGINE = InnoDB<span class="built_in"> DEFAULT </span>CHARSET = utf8mb4 COMMENT = <span class="string">'都城聊天表'</span> ;</span><br><span class="line"></span><br><span class="line">CREATE TABLE t_food_comment_star_refs(</span><br><span class="line">    id int(11) auto_increment primary key COMMENT <span class="string">'关系id'</span>,</span><br><span class="line">    comment_id int(11) <span class="keyword">NOT</span> <span class="literal">NULL</span> COMMENT <span class="string">'评论id'</span>,</span><br><span class="line">    comment_fid int(11) <span class="keyword">NOT</span> <span class="literal">NULL</span> COMMENT <span class="string">'用户id'</span>,</span><br><span class="line">    star_fid int(11) <span class="keyword">NOT</span> <span class="literal">NULL</span> COMMENT <span class="string">'点赞用户fid'</span>,</span><br><span class="line">    create_time BIGINT(20)<span class="built_in"> DEFAULT </span>0 <span class="keyword">NOT</span> <span class="literal">NULL</span> COMMENT <span class="string">'创建时间'</span>,</span><br><span class="line">    update_time BIGINT(20)<span class="built_in"> DEFAULT </span>0 <span class="keyword">NOT</span> <span class="literal">NULL</span> COMMENT <span class="string">'修改时间'</span>,</span><br><span class="line">    UNIQUE KEY `idx_comment_id_fid_star_fid` (`comment_id`,`comment_fid`,`star_fid`) USING BTREE</span><br><span class="line">)ENGINE = InnoDB<span class="built_in"> DEFAULT </span>CHARSET = utf8mb4 COMMENT = <span class="string">'都城评论点赞关联表'</span> ;</span><br></pre></td></tr></table></figure>
<h1 id="项目部署"><a href="#项目部署" class="headerlink" title="项目部署"></a>项目部署</h1><h2 id="前端部署"><a href="#前端部署" class="headerlink" title="前端部署"></a>前端部署</h2><h3 id="本地开发"><a href="#本地开发" class="headerlink" title="本地开发"></a>本地开发</h3><blockquote>
<p>npm run dev</p>
</blockquote>
<h3 id="开发路径"><a href="#开发路径" class="headerlink" title="开发路径"></a>开发路径</h3><blockquote>
<p><a href="http://localhost:3006/food/login" target="_blank" rel="noopener">http://localhost:3006/food/login</a></p>
</blockquote>
<h3 id="线上部署"><a href="#线上部署" class="headerlink" title="线上部署"></a>线上部署</h3><blockquote>
<p>npm install pm2 -g</p>
</blockquote>
</li>
</ol>
<blockquote>
<p>npm run build</p>
</blockquote>
<p>会生成一个build的文件夹，里面是线上需要用到的资源</p>
<blockquote>
</blockquote>
<h3 id="nginx设置"><a href="#nginx设置" class="headerlink" title="nginx设置"></a>nginx设置</h3><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// /<span class="meta">opt</span>/food/fontend/<span class="keyword">build/ </span>是npm run <span class="keyword">build的文件夹路径</span></span><br><span class="line"><span class="keyword">location </span>/assets/ &#123;</span><br><span class="line">   <span class="meta">alias</span> /<span class="meta">opt</span>/food/fontend/<span class="keyword">build/;</span></span><br><span class="line"><span class="keyword">&#125;</span></span><br><span class="line"><span class="keyword">location </span>/ &#123;</span><br><span class="line">  proxy_pass http://<span class="number">127</span>.<span class="number">0</span>.<span class="number">0</span>.<span class="number">1</span>:<span class="number">3006</span>/<span class="comment">;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="使用pm2开启项目"><a href="#使用pm2开启项目" class="headerlink" title="使用pm2开启项目"></a>使用pm2开启项目</h3><blockquote>
<p>pm2 start pm2.prod.json</p>
</blockquote>
<h2 id="后端部署"><a href="#后端部署" class="headerlink" title="后端部署"></a>后端部署</h2><h3 id="本地开发-1"><a href="#本地开发-1" class="headerlink" title="本地开发"></a>本地开发</h3><blockquote>
<p>pm2 start app.js –watch</p>
</blockquote>
<p>开启 –watch 模式监听项目日志</p>
<h3 id="线上部署-1"><a href="#线上部署-1" class="headerlink" title="线上部署"></a>线上部署</h3><blockquote>
<p>pm2 start app.js</p>
</blockquote>
<p>千万不要开启 –watch，因为没请求一次服务会刷新产生数据库和redis重连，导致报错</p>
<h1 id="结尾"><a href="#结尾" class="headerlink" title="结尾"></a>结尾</h1><p>开发完这个系统用了三个星期赶上寒冬我就离职了…然后去面试一些公司拿这个小玩意给面试官看，HR挺满意的，就是不知道技术官满不满意。</p>
<p>欢迎大家来交流哦~</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/05/24/hello-world/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="FEA-Dven">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="FEA-Dven的技术博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/05/24/hello-world/" itemprop="url">Hello World</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-05-24T16:46:19+08:00">
                2020-05-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/one-command-deployment.html" target="_blank" rel="noopener">Deployment</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  


          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.jpg"
                alt="FEA-Dven" />
            
              <p class="site-author-name" itemprop="name">FEA-Dven</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/%7C%7Carchive">
              
                  <span class="site-state-item-count">2</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">FEA-Dven</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i> 总访客
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      人
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i>总访问量
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      次
    </span>
  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
